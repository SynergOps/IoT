# 07_PWM_Fade - Ομαλή Μεταβολή Φωτεινότητας

## Περιγραφή
Χρήση του Pulse Width Modulation (PWM) για αυξομείωση της φωτεινότητας ενός LED (εφέ "Pulse").

## 🔌 Αναλογικά vs Ψηφιακά Σήματα

Πριν μάθουμε το PWM, πρέπει να καταλάβουμε τις διαφορές:

### Ψηφιακά Σήματα (Digital)
```
Τάση
  5V  ▔▔▔▔▔▔▔▔       ▔▔▔▔▔▔▔▔
      │      │       │      │
  0V  └──────┘───────└──────┘
      
      ON/OFF, 1/0, HIGH/LOW
      (Μόνο δύο καταστάσεις)
```

**Παράδειγμα:** Ένα κουμπί είναι ψηφιακό - είτε πατημένο (HIGH), είτε όχι (LOW).

### Αναλογικά Σήματα (Analog)
```
Τάση
  5V   ┌────────╲        ╱.        /─┐
       │         ╲      ╱  \      /  │
 3.2V  │          ╲    ╱    \    /   │
       │           ╲  ╱      \  /    │
 0.5V  └────────────╲╱────────\/─────┘
       
   Οποιαδήποτε τιμή μεταξύ 0-5V
   (Πολλές ενδιάμεσες τιμές)
   (Ομαλή, συνεχής μεταβολή)
```

**Παράδειγμα:** Ένας αισθητήρας θερμοκρασίας εξάγει αναλογικό σήμα που μπορεί να έχει οποιαδήποτε τιμή μεταξύ 0-5V (π.χ., 0.5V, 1.3V, 3.2V κλπ.).

### Το Πρόβλημα με το Arduino Uno
Το Arduino Uno έχει **ψηφιακούς pins** (D0-D13) που μπορούν να παράγουν μόνο:
- **HIGH (5V)** = LED αναμμένο πλήρως
- **LOW (0V)** = LED σβηστό

Δεν μπορούμε να παράγουμε αναλογικά σήματα απευθείας! 

**Τι κάνουμε αν θέλουμε ενδιάμεσες φωτεινότητες;** (π.χ., 50% φωτεινότητα)

---

## 💡 Γιατί Χρειαζόμαστε PWM;

Η λύση: **Εξαπατούμε την ανθρώπινη όραση!** 

Αν αναβοσβήνουμε το LED **πολύ γρήγορα** μεταξύ ON και OFF, το μάτι δεν μπορεί να παρακολουθήσει - βλέπει το LED σαν να είναι στη **μέση φωτεινότητα**.

```
Παράδειγμα: LED ανάβει 50% του χρόνου, σβήνει 50%

100% duty cycle (πλήρης):    ▔▔▔▔▔▔▔▔▔ (πάντα ON)
50% duty cycle (μέσο):       ▔▔▔▔░░░░░ (αναβοσβήνει)
25% duty cycle (σκοτεινό):   ▔▔░░░░░░░ (λίγο ανάβει)
0% duty cycle (σβηστό):      ░░░░░░░░░ (πάντα OFF)

Η ανθρώπινη όραση αντιλαμβάνεται την **ΜΕΣΗ** φωτεινότητα
```

### TL;DR (με απλά λόγια)
- Τι: Άναψε/σβήσε πολύ γρήγορα το LED.
- Γιατί: Με ψηφιακή έξοδο (ON/OFF) πετυχαίνουμε «ενδιάμεση» φωτεινότητα.
- Πώς: Το ποσοστό χρόνου που είναι ON λέγεται duty cycle (0–100%).
- Κώδικας: `analogWrite(pin, τιμή)` όπου τιμή 0–255 ≈ 0–100%.
- Παράδειγμα: `analogWrite(9, 128)` ≈ 50% → μισή φωτεινότητα.

---

## 📊 Τι είναι το PWM;

**PWM (Pulse Width Modulation)** = Διαμόρφωση Εύρους Παλμού

```
analogWrite(pin, 0):     ________  0% duty cycle   → 0V μέσος όρος
analogWrite(pin, 64):    ▔ ▔ ▔ ▔   25% duty cycle  → 1.25V
analogWrite(pin, 128):   ▔▔  ▔▔    50% duty cycle  → 2.5V
analogWrite(pin, 192):   ▔▔▔ ▔▔▔   75% duty cycle  → 3.75V
analogWrite(pin, 255):   ▔▔▔▔▔▔▔▔  100% duty cycle → 5V
```

**Σημείωση:** Η μέγιστη τιμή είναι **255**. Αυτό οφείλεται στον μικροελεγκτή **ATmega328P** του Arduino Uno, ο οποίος χρησιμοποιεί καταχωρητές **8-bit** για την παραγωγή του PWM ($2^8 = 256$ τιμές).
Αν βάλετε μεγαλύτερη τιμή (π.χ. 300), γίνεται μετατροπή σε **8-bit (wrap)** και η τιμή ουσιαστικά γίνεται **44**.

### Πώς Λειτουργεί Πρακτικά;

- **Συχνότητα PWM:** Στο Arduino Uno είναι περίπου **490Hz** (490 κύκλοι/δευτ.).
- **Σημείωση ανά pin:** Τα **D5/D6 ≈ 976Hz**, ενώ τα **D3/D11/D9/D10 ≈ 490Hz** (προεπιλογές χρονιστών).
- **Τι βλέπει το μάτι:** Πάνω από ~30–60 αναβοσβησίες/δευτ. το μάτι δεν ξεχωρίζει τα ON/OFF. Βλέπει τον **μέσο όρο**.
- **Συμπέρασμα:** Περισσότερο χρόνο ON → πιο φωτεινό. Λιγότερο χρόνο ON → πιο σκοτεινό.

Παραδείγματα (διαισθητικά):
- 100% duty cycle → πάντα ON → πλήρης φωτεινότητα
- ~50% duty cycle → μισό χρόνο ON → μέση φωτεινότητα
- ~25% duty cycle → λίγο ON → σκοτεινότερο

---

## Πού χρησιμοποιείται σε υλοποίηση IoT;
*   **Smart Lighting:** Οι έξυπνες λάμπες (π.χ. Wi-Fi bulbs) χρησιμοποιούν PWM για να ρυθμίσουν τη φωτεινότητα και να αναμείξουν χρώματα (RGB).
*   **Έλεγχος Κινητήρων:** Σε drones και ρομποτικά οχήματα, το PWM καθορίζει την ταχύτητα περιστροφής των μοτέρ.
*   **Haptic Feedback:** Σε wearables (smartwatches), η ένταση της δόνησης για ειδοποιήσεις ρυθμίζεται συχνά με PWM.

## Μαθησιακοί Στόχοι
- Κατανόηση PWM (Pulse Width Modulation)
- Χρήση `analogWrite()` για έλεγχο φωτεινότητας
- Διάκριση PWM pins από απλά digital pins
- Loops με for για σταδιακές αλλαγές

## Σχεδιάγραμμα Κυκλώματος

```
           ┌─────────────────┐
           │   Arduino Uno   │
           │                 │
           │      D9 (~)     ├────┐
           │                 │    │
           │      GND        ├──┐ │
           └─────────────────┘  │ │
                                │ │
                              ┌─┴─┴─┐
                    220Ω      │ R   │
                    ┌─────────┤     │
                    │         └─────┘
                    │
                 ───▼───  LED (κόκκινο/πράσινο)
                 ───────  (Anode +)
                    │
                    │     (Cathode -)
                    └──────────► GND
```

## Υλικά που Χρειάζονται
*Κρατήστε το κύκλωμα με το κουμπί από το προηγούμενο μάθημα στο breadboard. Θα το χρειαστούμε αργότερα!*

**Για αυτό το μάθημα θα προσθέσουμε:**
- 1× LED (οποιοδήποτε χρώμα)
- 1× Αντίσταση 220Ω (🔴 Κόκκινο - 🔴 Κόκκινο - 🟤 Καφέ)
- 2× Καλώδια jumper

**Γιατί χρειαζόμαστε εξωτερικό LED τώρα;**
Μέχρι τώρα χρησιμοποιούσαμε το ενσωματωμένο LED (Pin 13) για ευκολία. Όμως, το Pin 13 στο Arduino Uno **δεν υποστηρίζει PWM** (δεν έχει το σύμβολο `~`). Για να κάνουμε το εφέ "Fade", πρέπει να συνδέσουμε ένα LED σε ένα PWM pin (π.χ. D9).

## Τι είναι το PWM;

**PWM (Pulse Width Modulation)** = Διαμόρφωση Εύρους Παλμού

```
analogWrite(pin, 0):     ________  0% duty cycle   → 0V μέσος όρος
analogWrite(pin, 64):    ▔ ▔ ▔ ▔   25% duty cycle  → 1.25V
analogWrite(pin, 128):   ▔▔  ▔▔    50% duty cycle  → 2.5V
analogWrite(pin, 192):   ▔▔▔ ▔▔▔   75% duty cycle  → 3.75V
analogWrite(pin, 255):   ▔▔▔▔▔▔▔▔  100% duty cycle → 5V
```

Γρήγορη αντιστοίχιση τιμών σε ποσοστά:
- `0` ≈ 0% duty → σβηστό
- `128` ≈ 50% duty → μέση φωτεινότητα
- `255` ≈ 100% duty → πλήρες φως

**Σημείωση:** Η μέγιστη τιμή είναι **255**. Αυτό οφείλεται στον μικροελεγκτή **ATmega328P** του Arduino Uno, ο οποίος χρησιμοποιεί καταχωρητές **8-bit** για την παραγωγή του PWM ($2^8 = 256$ τιμές).
Αν βάλετε μεγαλύτερη τιμή (π.χ. 300), το Arduino θα κάνει "υπερχείλιση" (overflow) και το αποτέλεσμα θα είναι απρόβλεπτο (π.χ. 300 γίνεται 44).

## Σημείωση για το delay() vs millis()
Σε αυτό το μάθημα χρησιμοποιούμε την εντολή `delay()` μέσα στον βρόχο `for` για να δημιουργήσουμε το εφέ του "παλμού".
Παρόλο που μάθαμε την `millis()` στο προηγούμενο μάθημα, εδώ η `delay()` είναι αποδεκτή επειδή:
1. Θέλουμε να εστιάσουμε στην έννοια του **PWM** και των βρόχων **for**.
2. Η κίνηση είναι γραμμική και προβλέψιμη.

*Πρόκληση:* Αν θέλατε να κάνετε το LED να "αναπνέει" ενώ ταυτόχρονα διαβάζετε ένα κουμπί, θα έπρεπε να αντικαταστήσετε την `delay()` και το `for` loop με λογική `millis()`!

**Στο Uno, μόνο τα pins με ~ μπορούν να κάνουν PWM:**
- D3, D5, D6, D9, D10, D11

## Οδηγίες Σύνδεσης

### Βήμα προς Βήμα:
1. Τοποθετήστε το LED στο breadboard
2. Προσδιορίστε την πολικότητα:
   - **Μακρύ πόδι (Anode +)** → συνδέεται στην αντίσταση
   - **Κοντό πόδι (Cathode -)** → συνδέεται στο GND
3. Συνδέστε την αντίσταση 220Ω από το anode στο **D9**
4. Συνδέστε το cathode στο **GND**

### ⚠️ Προσοχή:
- Πάντα χρησιμοποιείτε αντίσταση με LED (220Ω-330Ω)
- Χωρίς αντίσταση → LED καίγεται! 🔥
- Λάθος πολικότητα → LED δεν ανάβει

## Πώς να το Τρέξετε

1. Ανοίξτε το `pwm_fade.ino`
2. Ανεβάστε στο Arduino
3. Το LED θα fade σταδιακά πάνω-κάτω σε loop

## Επεξήγηση Κώδικα

```cpp
const int PWM_LED = 9;  // PWM pin (πρέπει να έχει ~)

void setup(){
  pinMode(PWM_LED, OUTPUT);
}

void loop(){
  // Fade up: 0 → 255
  for (int v = 0; v <= 255; v++) {
    analogWrite(PWM_LED, v);
    delay(5);  // 5ms ανά βήμα = ομαλό fade
  }
  
  // Fade down: 255 → 0
  for (int v = 255; v >= 0; v--) {
    analogWrite(PWM_LED, v);
    delay(5);
  }
}
```

### Βασικές Εντολές:
- **analogWrite(pin, value)**: PWM output (0-255)
  - `0` = εντελώς σβηστό
  - `255` = πλήρης φωτεινότητα
- **for loop**: Επαναλαμβάνει με αυξανόμενη/μειούμενη μεταβλητή

## Πειραματισμός

### 1. Αλλαγή Ταχύτητας Fade:
```cpp
delay(10);   // Πιο αργό fade
delay(1);    // Πιο γρήγορο fade
```

### 2. Διαφορετικά Μοτίβα:
```cpp
// Pulse effect
analogWrite(PWM_LED, 128);  // Σταθερό 50% φωτεινότητα
delay(100);
analogWrite(PWM_LED, 255);  // Flash
delay(50);
```

### 3. RGB LED (προχωρημένο):
```cpp
// Χρειάζονται 3 PWM pins (π.χ. D9, D10, D11)
analogWrite(9, 255);   // Κόκκινο
analogWrite(10, 0);    // Πράσινο
analogWrite(11, 128);  // Μπλε → Μωβ
```

### 4. Μη-αποκλειστικό Fade με millis():
```cpp
// Συνδυασμός PWM + millis() για fade χωρίς delay()
unsigned long lastUpdate = 0;
int brightness = 0;
int fadeAmount = 1;

void loop() {
  if (millis() - lastUpdate >= 5) {
    lastUpdate = millis();
    brightness += fadeAmount;
    
    if (brightness <= 0 || brightness >= 255) {
      fadeAmount = -fadeAmount;  // Αντιστροφή κατεύθυνσης
    }
    
    analogWrite(PWM_LED, brightness);
  }
}
```

## Troubleshooting

| Πρόβλημα | Λύση |
|----------|------|
| LED δεν ανάβει | Ελέγξτε πολικότητα, αντίσταση, PWM pin (~) |
| LED αναβοσβήνει αντί να fade | Φυσιολογικό σε χαμηλές τιμές, δοκιμάστε 30-255 |
| Καμμένο LED | Ξεχάσατε την αντίσταση - αντικαταστήστε LED |
| Fade δεν λειτουργεί | Σιγουρευτείτε ότι χρησιμοποιείτε PWM pin |

## Σημαντικές Διευκρινίσεις

### analogWrite() ≠ Πραγματικό Αναλογικό
- Το Arduino Uno **δεν έχει DAC** (Digital-to-Analog Converter)
- To `analogWrite()` είναι **PWM**, όχι πραγματική αναλογική τάση
- Η συχνότητα PWM είναι ~490Hz (ορατό σε αργή κάμερα)

### analogRead() vs analogWrite()
```cpp
analogRead(A0);         // Διάβασμα από analog pin (A0-A5) → 0-1023
analogWrite(9, 128);    // Εγγραφή PWM σε PWM pin (D3,5,6,9,10,11) → 0-255
```

**Προσοχή:** Δεν μπορείτε να κάνετε `analogWrite()` στα A0-A5!

## Επόμενο Βήμα
Μάθετε **08_Serial_Communication** για debugging και έλεγχο από υπολογιστή.
